#!/bin/bash -li

# config change commit
pushd ~
cb=$(config rev-parse --abbrev-ref HEAD)
[ $# -lt 1 ] || config stash; 
config checkout master; 
chmod 644 ~/.ssh/config
config pull --no-edit && \
chmod 644 ~/.ssh/config && \
( [ $# -lt 1 ] || (config stash pop && config commit -asm "$*" && config push ) ) && \  # $# < 1, no commit message, just pull
config checkout "$cb" && \
config merge --no-edit master && \
chmod 644 ~/.ssh/config && \
#config submodule init && config submodule update
popd
