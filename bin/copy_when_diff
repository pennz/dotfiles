#!/bin/bash
for filename in "$@"; do
    cp "$filename" ."$filename"
    kup "$filename" & # a little slow, so put it to background
    while true; do
        #diff_content=$(diff ."$filename" "$filename")
        #[ x = x"$diff_content" ] || cp "$filename" ."$filename"
        #echo $diff_content
        colordiff -uw --suppress-blank-empty ."$filename" "$filename" || cp "$filename" ."$filename"
        sleep 5  # check every 5 s
    done&

    inotifywait -q -m -e close_write ."$filename" | while read -r filename event; do kup "${filename#.}"; echo "$(date) ${filename#.} updated"; done&
done
